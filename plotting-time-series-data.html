<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Chapter 3 Plotting Time Series Data | Risk Analysis in the Earth Sciences" />
<meta property="og:type" content="book" />

<meta property="og:image" content="/images/cover_with_alexander.png" />

<meta name="github-repo" content="vsrikrish/RAES" />

<meta name="author" content="Vivek Srikrishnan" />
<meta name="author" content="Klaus Keller" />

<meta name="date" content="2021-12-15" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="Chapter 3 Plotting Time Series Data | Risk Analysis in the Earth Sciences">

<title>Chapter 3 Plotting Time Series Data | Risk Analysis in the Earth Sciences</title>

<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/envisioned.css" rel="stylesheet" />
<link href="libs/msmb-css-0/msmb.css" rel="stylesheet" />
<script>
function toggle_visibility(id1, id2) {
var e = document.getElementById(id1);
var f = document.getElementById(id2);

e.style.display = ((e.style.display!='none') ? 'none' : 'block');

if(f.classList.contains('fa-plus-square')) {
    f.classList.add('fa-minus-square')
    f.classList.remove('fa-plus-square')
} else {
    f.classList.add('fa-plus-square')
    f.classList.remove('fa-minus-square')
}

}
</script>
<script>
function copy_link(id) {
  var dummy = document.createElement('input'),
  text = window.location.href.split(/[?#]/)[0] + '#' + id;
  document.body.appendChild(dummy);
  dummy.value = text;
  dummy.select();
  document.execCommand('copy');
  document.body.removeChild(dummy);
  
  var tooltip = document.getElementById(id + '-tooltip');
  tooltip.innerHTML = 'Copied!';
}

function reset_tooltip(id) {
  var tooltip = document.getElementById(id);
  tooltip.innerHTML = 'Copy link';
}
</script>
<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }

code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>



<link rel="stylesheet" href="css/style.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul class="navbar">
<li class="msmb"><p class="title">Risk Analysis in the Earth Sciences<p><p class="author">Vivek Srikrishnan, Klaus Keller</p>
<li class="dropdown" style="float:right">
<a href="javascript:void(0)" class="dropbtn">&#x25BE; Chapters</a>
<div class="dropdown-content">
<a href="index.html">Preface</a>
<a href="about-this-book.html">About This Book</a>
<a href="what-is-climate-risk.html"><span class="toc-section-number">1</span> What is Climate Risk?</a>
<a href="julia-syntax.html"><span class="toc-section-number">2</span> Learning the basics of Julia</a>
<a id="active-page" href="plotting-time-series-data.html"><span class="toc-section-number">3</span> Plotting Time Series Data</a><ul class="toc-sections">
<li class="toc"><a href="#introduction-1"> Introduction</a></li>
<li class="toc"><a href="#tutorial"> Tutorial</a></li>
<li class="toc"><a href="#exercises"> Exercises</a></li>
</ul>
<a href="normal-distributions-and-the-galton-board.html"><span class="toc-section-number">4</span> Normal distributions and the Galton board</a>
<a href="markov-chain-monte-carlo.html"><span class="toc-section-number">5</span> Markov Chain Monte Carlo</a>
<a href="references.html">References</a>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<div id="plotting-time-series-data" class="section level1">
<h1>
<span class="header-section-number">Chapter 3</span> Plotting Time Series Data</h1>
<p>This chapter was written by Patrick J. Applegate and Vivek Srikrishnan.</p>
<div id="learning-objectives-1" class="section level3 unnumbered">
<h3>Learning Objectives<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('learning-objectives-1')" onmouseout="reset_tooltip('learning-objectives-1-tooltip')"><span class="tooltiptext" id="learning-objectives-1-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<p>After completing this chapter, you should be able to</p>
<ul>
<li>explain the relationship between atmospheric carbon dioxide concentration, surface air temperature, and sea level</li>
<li>download data from the Internet using Julia</li>
<li>read data files into Julia</li>
<li>make simple plots in Julia, including
<ul>
<li>plots with multiple panels</li>
<li>plots with multiple curves in the same panel</li>
</ul>
</li>
</ul>
</div>
<div id="introduction-1" class="section level2">
<h2>
<span class="header-section-number">3.1</span> Introduction<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('introduction-1')" onmouseout="reset_tooltip('introduction-1-tooltip')"><span class="tooltiptext" id="introduction-1-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<p>This textbook on climate risk management will discuss sea-level rise extensively. Many people live near present-day sea level <span class="citation">(e.g. Nicholls et al., <a href="#ref-Nicholls2008-af" role="doc-biblioref">2008</a>)</span>, and rises in sea level expose these people to the possibility of flooding. For example, the ongoing increase in sea level will likely cause communities on the United States’ eastern coast to experience frequent flooding within the next few decades <span class="citation">(Spanger-Siegfried et al., <a href="#ref-Spanger-Siegfried2014-mx" role="doc-biblioref">2014</a>)</span>.</p>
<p>Sea level rise is caused by temperature increases, which in turn are driven by increases in carbon dioxide concentrations in the atmosphere. Carbon dioxide is produced by human activities and natural processes. Increases in carbon dioxide concentrations in the atmosphere enhance the trapping of infrared radiation near the Earth’s surface and contribute to rises in surface air temperatures. As the ocean absorbs some excess heat from the atmosphere, its temperature increases, causing it to expand and causing sea level rise. Temperature increases cause melt of glaciers and ice sheets, which leads to sea level rise by adding mass to the oceans.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:co2tempslr"></span>
<p class="caption marginnote shownote">
Figure 3.1: Atmospheric carbon dioxide concentrations (top panel), surface air temperature change (middle panel), and sea level change (bottom panel), between 1900 and ~2015. All three quantities rise over this period, possibly suggesting a causal relationship between them given a plausible theoretical connection. See text for discussion.
</p>
<img src="raes_files/figure-html/co2tempslr-J1.png" alt="Atmospheric carbon dioxide concentrations (top panel), surface air temperature change (middle panel), and sea level change (bottom panel), between 1900 and ~2015.  All three quantities rise over this period, possibly suggesting a causal relationship between them given a plausible theoretical connection. See text for discussion." width="75%">
</div>
<p>Data covering the last century support this relationship between atmospheric carbon dioxide concentrations, temperature, and sea level (Fig. <a href="plotting-time-series-data.html#fig:co2tempslr">3.1</a>). The curves in the three panels of Figure <a href="plotting-time-series-data.html#fig:co2tempslr">3.1</a> rise together, suggesting that these variables are related.</p>
<div class="center">
<div class="info">
<p>Although correlation does not prove causation, the combination of a clear relationship between variables with a plausible explanation for why they should be related is evidence for causation.</p>
</div>
</div>
<p>Frequent, accurate measurements of carbon dioxide in the atmosphere began in the late 1950s at Mauna Loa in Hawaii <span class="citation">(Keeling et al., <a href="#ref-Keeling1976-bc" role="doc-biblioref">1976</a>, blue curve in Fig. <a href="plotting-time-series-data.html#fig:co2tempslr">3.1</a>, top panel)</span>. These measurements show an annual cycle that represents Northern Hemisphere seasons. Plants lose their leaves or die during the winter, releasing carbon dioxide to the atmosphere. The Northern Hemisphere has much more land, and therefore more plants, than the Southern Hemisphere. Thus, the Northern Hemisphere’s seasons largely control the variability in atmospheric carbon dioxide concentrations within any individual year. However, there is a definite upward trend in this curve that is larger than the amplitude of the annual cycle.</p>
<p>Measurements of former atmospheric compositions from bubbles trapped in ice cores allow us to extend the observational record of carbon dioxide concentrations farther back in time <span class="citation">(MacFarling Meure et al., <a href="#ref-MacFarling_Meure2006-wa" role="doc-biblioref">2006</a>, black curve in Fig. <a href="plotting-time-series-data.html#fig:co2tempslr">3.1</a>, top panel)</span>. As snow falls on the Greenland and Antarctic ice sheets, it traps samples of the atmosphere. Because new snow buries and compresses old snow, the time at which different snow samples fell can be estimated by counting the layers in an ice sheet. The ice core measurements of atmospheric carbon dioxide concentrations are less finely resolved in time than the direct measurements, and therefore don’t reflect the annual cycle of CO<sub>2</sub> in the atmosphere. However, the trend of the ice core data is similar to that of the direct observations during the period when they overlap, suggesting that the ice core data are reliable.</p>
<p>Because carbon dioxide mixes readily in the atmosphere, measurements of atmospheric carbon dioxide concentrations at most places on the Earth’s surface are relatively representative of the globe as a whole. In contrast, both surface air temperatures and sea levels are measured at widely dispersed stations and must be aggregated to give a global mean value. Global mean temperatures must be estimated from individual weather stations with long records <span class="citation">(Hansen et al., <a href="#ref-Hansen2010-wg" role="doc-biblioref">2010</a>)</span>; past sea levels are estimated using data from tide gages <span class="citation">(Jevrejeva et al., <a href="#ref-Jevrejeva2014-my" role="doc-biblioref">2014</a>)</span>. As one might expect, there are various methods for performing this aggregation, and the different methods give somewhat different answers. However, it seems clear that both global mean surface air temperature and global mean sea level are rising.</p>
<p>In this chapter, you’ll examine an R script that downloads the data files needed to make the top two panels of Figure <a href="plotting-time-series-data.html#fig:co2tempslr">3.1</a> from the Internet and plots them. You’ll then modify the script so that it plots all three panels of Figure <a href="plotting-time-series-data.html#fig:co2tempslr">3.1</a>.</p>
</div>
<div id="tutorial" class="section level2">
<h2>
<span class="header-section-number">3.2</span> Tutorial<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('tutorial')" onmouseout="reset_tooltip('tutorial-tooltip')"><span class="tooltiptext" id="tutorial-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<p>We’ll start by looking at several Web pages that describe the data we’ll be using in this exercise. As of May 2015, the various data sets displayed in Figure <a href="plotting-time-series-data.html#fig:co2tempslr">3.1</a> are archived in the following places:</p>
<p><!--
<caption>--><span class="marginnote shownote"><span id="tab:climatedata">Table 3.1: </span> Internet sources of data used in Exercise #1 and associated references. NOAA, National Oceanic and Atmospheric Administration; DOE CDIAC, United States Department of Energy – Carbon Dioxide Analysis Center; NASA GISS, National Aeronautics and Space Administration – Goddard Institute for Space Studies; PSMSL, Permanent Service for Mean Sea Level.</span><!--</caption>--></p>
<table>
<thead><tr class="header">
<th>Data type</th>
<th>Reference</th>
<th>Location on the Web</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>CO<sub>2</sub>, direct measurements</td>
<td><span class="citation">Keeling et al. (<a href="#ref-Keeling1976-bc" role="doc-biblioref">1976</a>)</span></td>
<td><a href="http://www.esrl.noaa.gov/gmd/ccgg/trends/">NOAA</a></td>
</tr>
<tr class="even">
<td>CO<sub>2</sub>, Law Dome ice core</td>
<td><span class="citation">MacFarling Meure et al. (<a href="#ref-MacFarling_Meure2006-wa" role="doc-biblioref">2006</a>)</span></td>
<td><a href="http://cdiac.ornl.gov/trends/co2/modern_co2.html">DOE CDIAC</a></td>
</tr>
<tr class="odd">
<td>Surface air temperature change</td>
<td><span class="citation">Hansen et al. (<a href="#ref-Hansen2010-wg" role="doc-biblioref">2010</a>)</span></td>
<td><a href="http://data.giss.nasa.gov/gistemp/">NASA GISS</a></td>
</tr>
<tr class="even">
<td>Sea level anomaly</td>
<td><span class="citation">Jevrejeva et al. (<a href="#ref-Jevrejeva2014-my" role="doc-biblioref">2014</a>)</span></td>
<td><a href="http://www.psmsl.org/products/reconstructions/jevrejevaetal2014.php">PSMSL</a></td>
</tr>
</tbody>
</table>
<p>Click on the links in the right-hand column of Table <a href="plotting-time-series-data.html#tab:climatedata">3.1</a> and look at the descriptions of the data stored there. Also look for links to the particular data sets mentioned in the Introduction. Some Web pages contain links to multiple data sets; we want the “<a href="ftp://aftp.cmdl.noaa.gov/products/trends/co2/co2_mm_mlo.txt">Mauna Loa CO<sub>2</sub> monthly mean data</a>,” <a href="ftp://ftp.ncdc.noaa.gov/pub/data/paleo/icecore/antarctica/law/law2006.txt">the Law Dome data</a> (scroll down to near the bottom of the page), and the “<a href="http://data.giss.nasa.gov/gistemp/tabledata_v3/GLB.Ts+dSST.txt">global-mean monthly, seasonal, and annual means, 1880-present, updated through most recent month</a>” of the "Land-Ocean Temperature Index, LOTI.</p>
<div id="downloading-the-data" class="section level3">
<h3>
<span class="header-section-number">3.2.1</span> Downloading the Data<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('downloading-the-data')" onmouseout="reset_tooltip('downloading-the-data-tooltip')"><span class="tooltiptext" id="downloading-the-data-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<p>Let’s step through how to make the first two panels of the plot above. Notice the liberal use of comments throughout the code; using comments like this is a good way to document your code and help yourself (and others!) interpret it.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb11-1"><a href="plotting-time-series-data.html#cb11-1"></a><span class="co"># if "data/" does not exist, create it</span></span>
<span id="cb11-2"><a href="plotting-time-series-data.html#cb11-2"></a>isdir(<span class="st">"data"</span>) || mkdir(<span class="st">"data"</span>); </span>
<span id="cb11-3"><a href="plotting-time-series-data.html#cb11-3"></a><span class="co"># download files and save in "data"</span></span>
<span id="cb11-4"><a href="plotting-time-series-data.html#cb11-4"></a>download(<span class="st">"ftp://aftp.cmdl.noaa.gov/products/trends/co2/co2_mm_mlo.txt"</span>, </span>
<span id="cb11-5"><a href="plotting-time-series-data.html#cb11-5"></a>    <span class="st">"data/co2_mm_mlo.txt"</span>);</span>
<span id="cb11-6"><a href="plotting-time-series-data.html#cb11-6"></a>download(<span class="st">"ftp://ftp.ncdc.noaa.gov/pub/data/paleo/icecore/antarctica/law/law2006.txt"</span>, </span>
<span id="cb11-7"><a href="plotting-time-series-data.html#cb11-7"></a>    <span class="st">"data/law2006.txt"</span>);</span>
<span id="cb11-8"><a href="plotting-time-series-data.html#cb11-8"></a>download(<span class="st">"https://data.giss.nasa.gov/gistemp/tabledata_v3/GLB.Ts+dSST.txt"</span>, </span>
<span id="cb11-9"><a href="plotting-time-series-data.html#cb11-9"></a>    <span class="st">"data/GLB.Ts+dSST.txt"</span>);</span></code></pre></div>
<p>The first line creates a <code>data/</code> directory if one does not already exist. It actually contains a compound command. As discussed in Section <a href="#boolean-operators"><strong>??</strong></a>, <code>||</code> is a <em>short-circuit</em> or operator. In this context, it first evaluates <code>isdir("data")</code>, which is <code>true</code> if <code>data/</code> exists and is a directory and <code>false</code> if not. If <code>isdir("data")</code> is <code>true</code>, there is no need to continue. If <code>data/</code> does not exist and <code>isdir("data")</code> is <code>false</code>, then it evaluates <code>mkdir("data")</code>, which makes the <code>data/</code> directory. This is a useful alternative in Julia to the following code:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb12-1"><a href="plotting-time-series-data.html#cb12-1"></a><span class="co"># if "data/" is not a directory, evaluate the rest</span></span>
<span id="cb12-2"><a href="plotting-time-series-data.html#cb12-2"></a><span class="kw">if</span> ! isdir(<span class="st">"data"</span>) </span>
<span id="cb12-3"><a href="plotting-time-series-data.html#cb12-3"></a>    <span class="co"># make the "data/" directory</span></span>
<span id="cb12-4"><a href="plotting-time-series-data.html#cb12-4"></a>    mkdir(<span class="st">"data"</span>) </span>
<span id="cb12-5"><a href="plotting-time-series-data.html#cb12-5"></a><span class="kw">end</span></span></code></pre></div>
<p>The <code>download(url, location)</code> commands download files and save them. The <code>url</code> argument is the source for the data, while <code>location</code> is the local path where the file should be saved.</p>
</div>
<div id="reading-the-data" class="section level3">
<h3>
<span class="header-section-number">3.2.2</span> Reading the Data<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('reading-the-data')" onmouseout="reset_tooltip('reading-the-data-tooltip')"><span class="tooltiptext" id="reading-the-data-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<p>Now that we have the files, we need to read the information that they contain into Julia. One of the tricky things with reading files is that you have to know something about how the file is formatted to specify how the code should read it. Open each of the data files using a text editor and examine them. Which files contain “extra” information at the top or bottom of the file? In each file, which columns contain the information we need?</p>
<p>You may notice that these files are <em>tab-delimited</em>, which means that columns are separated using tabs. Ither files may be space-delimited or comma-delimited, also known as comma-separated or CSV files. With this sort of structure, we can read in the files using the <code>readdlm()</code> command, which is short for “read delimited.” <code>readdlm()</code> is from the <code>DelimitedFiles.jl</code> package, which means we need to load it. <code>DelimitedFiles.jl</code> comes with base Julia, so there’s no installation required:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb13-1"><a href="plotting-time-series-data.html#cb13-1"></a>using DelimitedFiles <span class="co"># load DelimitedFiles.jl</span></span>
<span id="cb13-2"><a href="plotting-time-series-data.html#cb13-2"></a></span>
<span id="cb13-3"><a href="plotting-time-series-data.html#cb13-3"></a><span class="co"># begin reading in the data</span></span>
<span id="cb13-4"><a href="plotting-time-series-data.html#cb13-4"></a><span class="co">#  read Mauna Loa CO2 Data</span></span>
<span id="cb13-5"><a href="plotting-time-series-data.html#cb13-5"></a>loa_co2data = readdlm(<span class="st">"data/co2_mm_mlo.txt"</span>, skipstart=<span class="fl">57</span>, </span>
<span id="cb13-6"><a href="plotting-time-series-data.html#cb13-6"></a>    header=false);</span>
<span id="cb13-7"><a href="plotting-time-series-data.html#cb13-7"></a><span class="co"># read Law Dome CO2 Data</span></span>
<span id="cb13-8"><a href="plotting-time-series-data.html#cb13-8"></a>law_co2data = readdlm(<span class="st">"data/law2006.txt"</span>, skipstart = <span class="fl">183</span>, </span>
<span id="cb13-9"><a href="plotting-time-series-data.html#cb13-9"></a>    header = false)[<span class="fl">1</span>:<span class="fl">2004</span>, :]; </span></code></pre></div>
<p>In each of the <code>readdlm()</code> commands, the first argument is the file to open. Look at <a href="https://docs.julialang.org/en/v1/stdlib/DelimitedFiles/#Delimited-Files">the documentation for <code>readdlm()</code></a>. We also use two other options:
* <code>skipstart</code> skips the specified number of lines from the beginning of the file, which allows us to ignore headings and comments at the beginning of the file;
* <code>header = false</code> tells <code>readdlm()</code> not to interpret the first read line (after the skipped lines) as column headers for the resulting array.
We also tell Julia to only keep the first 2004 rows of the Law Dome data (after skipping the first 183 lines of the file). We do this because there is additional information at the bottom of the file that we do not need to keep.</p>
<p>The temperature data file is formatted in blocks, each of which contains about 20 years of data. For that reason, it is much more complicated to read into Julia. The code block below accomplishes this task using a <code>for</code> loop.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb14-1"><a href="plotting-time-series-data.html#cb14-1"></a><span class="co"># read in temperature data; this requires reading in sections </span></span>
<span id="cb14-2"><a href="plotting-time-series-data.html#cb14-2"></a><span class="co"># of the file one at a time</span></span>
<span id="cb14-3"><a href="plotting-time-series-data.html#cb14-3"></a><span class="co"># specify the row numbers where each chunk of data begins</span></span>
<span id="cb14-4"><a href="plotting-time-series-data.html#cb14-4"></a>start_rows = [<span class="fl">9</span>, <span class="fl">31</span>, <span class="fl">53</span>, <span class="fl">75</span>, <span class="fl">97</span>, <span class="fl">119</span>, <span class="fl">141</span>]; </span>
<span id="cb14-5"><a href="plotting-time-series-data.html#cb14-5"></a><span class="co"># how many rows are in each chunk</span></span>
<span id="cb14-6"><a href="plotting-time-series-data.html#cb14-6"></a>num_rows = [<span class="fl">19</span>, <span class="fl">20</span>, <span class="fl">20</span>, <span class="fl">20</span>, <span class="fl">20</span>, <span class="fl">20</span>, <span class="fl">18</span>]; </span>
<span id="cb14-7"><a href="plotting-time-series-data.html#cb14-7"></a><span class="co"># this computes the total amount of data before reading in </span></span>
<span id="cb14-8"><a href="plotting-time-series-data.html#cb14-8"></a><span class="co"># each chunk, which we need to index the resulting array</span></span>
<span id="cb14-9"><a href="plotting-time-series-data.html#cb14-9"></a>cum_num_rows = cumsum(num_rows); </span>
<span id="cb14-10"><a href="plotting-time-series-data.html#cb14-10"></a><span class="co"># initialize the storage for the temperature data array</span></span>
<span id="cb14-11"><a href="plotting-time-series-data.html#cb14-11"></a>temp_data = zeros(sum(num_rows), <span class="fl">20</span>); </span>
<span id="cb14-12"><a href="plotting-time-series-data.html#cb14-12"></a><span class="co"># read in the first chunk</span></span>
<span id="cb14-13"><a href="plotting-time-series-data.html#cb14-13"></a>temp_data[<span class="fl">1</span>:num_rows[<span class="fl">1</span>], :] = readdlm(<span class="st">"data/GLB.Ts+dSST.txt"</span>, </span>
<span id="cb14-14"><a href="plotting-time-series-data.html#cb14-14"></a>    skipstart = start_rows[<span class="fl">1</span>], header = false)[<span class="fl">1</span>:num_rows[<span class="fl">1</span>], :]; </span>
<span id="cb14-15"><a href="plotting-time-series-data.html#cb14-15"></a><span class="co"># loop over the remaining chunks and read them in</span></span>
<span id="cb14-16"><a href="plotting-time-series-data.html#cb14-16"></a><span class="kw">for</span> i = <span class="fl">2</span>:length(start_rows)</span>
<span id="cb14-17"><a href="plotting-time-series-data.html#cb14-17"></a>    temp_data[(cum_num_rows[i-<span class="fl">1</span>] + <span class="fl">1</span>):cum_num_rows[i], :] = </span>
<span id="cb14-18"><a href="plotting-time-series-data.html#cb14-18"></a>        readdlm(<span class="st">"data/GLB.Ts+dSST.txt"</span>, skipstart = start_rows[i], </span>
<span id="cb14-19"><a href="plotting-time-series-data.html#cb14-19"></a>            header = false)[<span class="fl">1</span>:num_rows[i], :];</span>
<span id="cb14-20"><a href="plotting-time-series-data.html#cb14-20"></a><span class="kw">end</span></span></code></pre></div>
</div>
<div id="plotting-the-data" class="section level3">
<h3>
<span class="header-section-number">3.2.3</span> Plotting the Data<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('plotting-the-data')" onmouseout="reset_tooltip('plotting-the-data-tooltip')"><span class="tooltiptext" id="plotting-the-data-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<p>Finally, we make the figure. This requires loading the <code>Plots.jl</code> package (see <a href="http://docs.juliaplots.org/latest/">its documentation</a>), which provides plotting functionality. If this were our first time making plots in Julia, we would need to install <code>Plots</code>, which we would do using <code>Pkg</code>. These lines are commented out in the code below because we’ve already done this for this book.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode julia"><code class="sourceCode julia"><span id="cb15-1"><a href="plotting-time-series-data.html#cb15-1"></a><span class="co">## install and load relevant packages</span></span>
<span id="cb15-2"><a href="plotting-time-series-data.html#cb15-2"></a><span class="co"># these two lines are commented out as we already have the </span></span>
<span id="cb15-3"><a href="plotting-time-series-data.html#cb15-3"></a><span class="co"># `Plots` library installed; if we did not, we would need to </span></span>
<span id="cb15-4"><a href="plotting-time-series-data.html#cb15-4"></a><span class="co"># include them</span></span>
<span id="cb15-5"><a href="plotting-time-series-data.html#cb15-5"></a><span class="co"># using Pkg</span></span>
<span id="cb15-6"><a href="plotting-time-series-data.html#cb15-6"></a><span class="co"># Pkg.add("Plots")</span></span>
<span id="cb15-7"><a href="plotting-time-series-data.html#cb15-7"></a></span>
<span id="cb15-8"><a href="plotting-time-series-data.html#cb15-8"></a><span class="co"># now we load `Plots.jl` as well as the `Plots.Measures` </span></span>
<span id="cb15-9"><a href="plotting-time-series-data.html#cb15-9"></a><span class="co"># subpackage, which lets us refer to units like "in" and "mm"</span></span>
<span id="cb15-10"><a href="plotting-time-series-data.html#cb15-10"></a>using Plots</span>
<span id="cb15-11"><a href="plotting-time-series-data.html#cb15-11"></a>using Plots.Measures</span>
<span id="cb15-12"><a href="plotting-time-series-data.html#cb15-12"></a><span class="co"># use GR backend; see text discussion</span></span>
<span id="cb15-13"><a href="plotting-time-series-data.html#cb15-13"></a>gr(); </span>
<span id="cb15-14"><a href="plotting-time-series-data.html#cb15-14"></a></span>
<span id="cb15-15"><a href="plotting-time-series-data.html#cb15-15"></a><span class="co">## first plot CO2 data</span></span>
<span id="cb15-16"><a href="plotting-time-series-data.html#cb15-16"></a><span class="co"># save the base Law Dome data plot as `p1`</span></span>
<span id="cb15-17"><a href="plotting-time-series-data.html#cb15-17"></a>p1 = plot(law_co2data[:, <span class="fl">1</span>], law_co2data[:, <span class="fl">6</span>], color=<span class="st">"black"</span>, </span>
<span id="cb15-18"><a href="plotting-time-series-data.html#cb15-18"></a>    label=<span class="st">"Law Dome Ice Core Record"</span>, legend=:top, grid=false);</span>
<span id="cb15-19"><a href="plotting-time-series-data.html#cb15-19"></a><span class="co"># add the Mauna Loa data on top of the Law Dome data</span></span>
<span id="cb15-20"><a href="plotting-time-series-data.html#cb15-20"></a>plot!(loa_co2data[:, <span class="fl">3</span>], loa_co2data[:, <span class="fl">5</span>], color=<span class="st">"blue"</span>, </span>
<span id="cb15-21"><a href="plotting-time-series-data.html#cb15-21"></a>    label=<span class="st">"Mauna Loa Measurements"</span>); </span>
<span id="cb15-22"><a href="plotting-time-series-data.html#cb15-22"></a><span class="co"># label the x-axis</span></span>
<span id="cb15-23"><a href="plotting-time-series-data.html#cb15-23"></a>xlabel!(<span class="st">"Year"</span>); </span>
<span id="cb15-24"><a href="plotting-time-series-data.html#cb15-24"></a><span class="co"># we only want to plot data after 1900 even though we have </span></span>
<span id="cb15-25"><a href="plotting-time-series-data.html#cb15-25"></a><span class="co"># more from Law Dome</span></span>
<span id="cb15-26"><a href="plotting-time-series-data.html#cb15-26"></a>xlims!((<span class="fl">1900</span>, <span class="fl">2020</span>)); </span>
<span id="cb15-27"><a href="plotting-time-series-data.html#cb15-27"></a><span class="co"># label the y-axis</span></span>
<span id="cb15-28"><a href="plotting-time-series-data.html#cb15-28"></a>ylabel!(<span class="st">"Atmospheric CO₂ (ppm)"</span>); </span>
<span id="cb15-29"><a href="plotting-time-series-data.html#cb15-29"></a></span>
<span id="cb15-30"><a href="plotting-time-series-data.html#cb15-30"></a><span class="co">## then plot temperature data</span></span>
<span id="cb15-31"><a href="plotting-time-series-data.html#cb15-31"></a><span class="co"># save the base temperature data plot as `p2`</span></span>
<span id="cb15-32"><a href="plotting-time-series-data.html#cb15-32"></a>p2 = plot(temp_data[:, <span class="fl">1</span>], temp_data[:, <span class="fl">14</span>] / <span class="fl">100</span>, </span>
<span id="cb15-33"><a href="plotting-time-series-data.html#cb15-33"></a>    color=<span class="st">"black"</span>, legend=false, grid=false); </span>
<span id="cb15-34"><a href="plotting-time-series-data.html#cb15-34"></a>xlabel!(<span class="st">"Year"</span>);</span>
<span id="cb15-35"><a href="plotting-time-series-data.html#cb15-35"></a>xlims!((<span class="fl">1900</span>, <span class="fl">2020</span>));</span>
<span id="cb15-36"><a href="plotting-time-series-data.html#cb15-36"></a>ylabel!(<span class="st">"Global Mean Temperature Anomaly (K)"</span>);</span>
<span id="cb15-37"><a href="plotting-time-series-data.html#cb15-37"></a></span>
<span id="cb15-38"><a href="plotting-time-series-data.html#cb15-38"></a><span class="co">## combine plots</span></span>
<span id="cb15-39"><a href="plotting-time-series-data.html#cb15-39"></a><span class="co"># finally, combine the two plots as two subplot rows</span></span>
<span id="cb15-40"><a href="plotting-time-series-data.html#cb15-40"></a>plot(p1, p2, layout= (<span class="fl">2</span>, <span class="fl">1</span>), left_margin=<span class="fl">20</span>mm, </span>
<span id="cb15-41"><a href="plotting-time-series-data.html#cb15-41"></a>    right_margin=<span class="fl">20</span>mm); </span>
<span id="cb15-42"><a href="plotting-time-series-data.html#cb15-42"></a><span class="co"># adjust the size so the final combined plot isn't squished </span></span>
<span id="cb15-43"><a href="plotting-time-series-data.html#cb15-43"></a><span class="co"># together</span></span>
<span id="cb15-44"><a href="plotting-time-series-data.html#cb15-44"></a>plot!(size=(<span class="fl">800</span>, <span class="fl">600</span>)) </span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:co2temp"></span>
<p class="caption marginnote shownote">
Figure 3.2: Plot results after running the code in this chapter. See text for discussion.
</p>
<img src="raes_files/figure-html/co2temp-J1.png" alt="Plot results after running the code in this chapter. See text for discussion." width="75%">
</div>
<p>Let’s walk through the code preceding Figure <a href="plotting-time-series-data.html#fig:co2temp">3.2</a>. First, <code>Plots</code> <a href="http://docs.juliaplots.org/latest/backends/">uses various backends</a> to provide varying capabilities. We will use the basic <code>GR</code> backend, so we call <code>gr()</code> after loading <code>Plots</code> to set this up. Next, we plot the Law Dome data using the <code>plot()</code> function. The first argument to <code>plot()</code> contains the x-coordinates of the data; this is the column specifying the year. The second argument are the y-coordinates, which is the sixth column in the data. We can also set the color (<code>color=black</code>) and the legend label (<code>label="Law Dome Ice Core Record"</code>), since the atmospheric CO<sub>2</sub> plot will also include the Mauna Loa data. Finally, we set the legend position to be top-center with <code>legend=:top</code> (there are lots of options for legend placement), and turn off the grid corresponding to the axis tick marks with <code>grid=false</code>. Notice that by default, <code>plots()</code> will plot this data as a line, though we could also <a href="http://docs.juliaplots.org/latest/tutorial/#Changing-the-Plotting-Series">set it to plot the data as points</a> if desired.</p>
<p>Next, we want to overlay the Mauna Loa data. As discussed earlier, the presence of an exclamation mark after a function name (<code>plots!()</code> as opposed to <code>plots()</code>) means that the function will modify its argument in-place, rather than returning a new variable. This allows us to avoid creating a new set of axes. We color this data blue to distinguish it from the Law Dome data series. We then can add axis labels (using <code>xlabel!()</code> and <code>ylabel!()</code>, which once again modify the current plot rather than creating a new plot object) and change the limits (in this case, we only want to change the x-axis limits to crop the data to post-1900).</p>
<p>Why did we save this plot object in the <code>p1</code> variable? This will allow us to later include it as a subplot in a final combined plot.</p>
<p>The process of creating the second subplot panel, stored as <code>p2</code>, is similar, only we have just the single temperature series, so we never need to make a call to <code>plot!()</code> or set up a legend. In fact, we turn off the legend with <code>legend=:false</code>.</p>
<p>We can now create our combined, two-panel plot with a call to <code>plot()</code>. In this case, we can just specify the two variables which stored our panels, <code>p1</code> and <code>p2</code>, and provide a layout (in the form <code>(rows, cols)</code>). It turns out that in this case, doing this cuts off the left and right edges of the plot, so we set a larger margin with <code>left_margin</code> and <code>right_margin</code>. We can use intuitive units like <code>mm</code> because we loaded <code>Plots.Measures</code>. Lastly, we modify the size plotting region with <code>plot!(size=(800, 600))</code> to spread out the plot to 800 pixels wide by 600 pixels tall and avoid the two panels from running into each other.</p>
<p>What if we wanted to save our figure as a file? To do that, we would use <a href="http://docs.juliaplots.org/latest/output/#savefig-/-format"><code>savefig(filename)</code></a> to save the last plot object in memory to <code>filename</code>. <code>savefig()</code> automatically encodes the plot properly based on the specified file extension.</p>
</div>
</div>
<div id="exercises" class="section level2">
<h2>
<span class="header-section-number">3.3</span> Exercises<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('exercises')" onmouseout="reset_tooltip('exercises-tooltip')"><span class="tooltiptext" id="exercises-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<div id="part-1" class="section level3 unlisted unnumbered">
<h3>Part 1<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('part-1')" onmouseout="reset_tooltip('part-1-tooltip')"><span class="tooltiptext" id="part-1-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<p>Copy the code from this chapter to a new file. Now, using what you’ve learned from following the detailed discussion above, modify the new file so that it produces a <code>.pdf</code> file like Figure <a href="plotting-time-series-data.html#fig:co2tempslr">3.1</a>, with three panels. The bottom panel should show the sea level anomalies from <span class="citation">Jevrejeva et al. (<a href="#ref-Jevrejeva2014-my" role="doc-biblioref">2014</a>)</span>. Specifically, you’ll need to add commands to your new file that</p>
<ol style="list-style-type: decimal">
<li>download the sea level anomaly data from <span class="citation">Jevrejeva et al. (<a href="#ref-Jevrejeva2014-my" role="doc-biblioref">2014</a>)</span> to your <code>data</code> folder (have a look at Table <a href="plotting-time-series-data.html#tab:climatedata">3.1</a>);</li>
<li>read in this data to a new variable (you might name your new variable <code>slr_data</code>);</li>
<li>causes the figure to have three panels instead of two;</li>
<li>plots the sea level anomaly data in the bottom panel;</li>
<li>adjusts the size of the resulting figure;</li>
<li>saves the figure to a file.</li>
</ol>
<p>Make sure that the lower panel of your plot has sensible axis limits in the x and y directions, as well as descriptive labels for the axes (see Fig. <a href="plotting-time-series-data.html#fig:co2tempslr">3.1</a> for an example).</p>
</div>
<div id="part-2" class="section level3 unlisted unnumbered">
<h3>Part 2<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('part-2')" onmouseout="reset_tooltip('part-2-tooltip')"><span class="tooltiptext" id="part-2-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<ol style="list-style-type: decimal">
<li>By how much have atmospheric carbon dioxide concentrations, global mean temperatures, and sea levels changed between 1900 and the early part of the present century? Hint: Check Figure <a href="plotting-time-series-data.html#fig:co2tempslr">3.1</a> and/or the figure produced by your updated Julia script.</li>
<li>How do the changes in atmospheric carbon dioxide concentrations, global mean temperatures, and sea levels between 1900 and 2015 compare to the changes in the same variables between the last ice age (~20,000 years ago) and preindustrial times (around 1850)? Give your results as the changes from Question #1, above, divided by the changes between the last ice age and the preindustrial period. Note that changes in temperature and sea level were small between 1850 and 1900. You’ll need to search the Web for values of these quantities during the last ice age and the preindustrial period. If this exercise is for a class, be sure to give the Internet sources you used in this part of the assignment.</li>
<li>How do the <em>rates</em> of change in atmospheric carbon dioxide concentrations, global mean temperatures, and sea levels between 1900 and 2015 compare to the rates of change in these quantities between the last ice age and preindustrial times? Recall that a rate of change is the change divided by the amount of time over which the change happens.</li>
</ol>
</div>
</div>
</div>
<h3>References<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('NA')" onmouseout="reset_tooltip('NA-tooltip')"><span class="tooltiptext" id="NA-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<div id="refs" class="references">
<div id="ref-Hansen2010-wg">
<p>Hansen, J., Ruedy, R., Sato, M., &amp; Lo, K. (2010). Global surface temperature change. <em>Rev. Geophys.</em>, <em>48</em>(4), 644. <a href="https://doi.org/10.1029/2010RG000345">https://doi.org/10.1029/2010RG000345</a></p>
</div>
<div id="ref-Jevrejeva2014-my">
<p>Jevrejeva, S., Moore, J. C., Grinsted, A., Matthews, A. P., &amp; Spada, G. (2014). Trends and acceleration in global and regional sea levels since 1807. <em>Glob. Planet. Change</em>, <em>113</em>, 11–22. <a href="https://doi.org/10.1016/j.gloplacha.2013.12.004">https://doi.org/10.1016/j.gloplacha.2013.12.004</a></p>
</div>
<div id="ref-Keeling1976-bc">
<p>Keeling, C. D., Bacastow, R. B., Bainbridge, A. E., Ekdahl, C. A., Jr., Guenther, P. R., Waterman, L. S., &amp; Chin, J. F. S. (1976). Atmospheric carbon dioxide variations at mauna loa observatory, hawaii. <em>Tell’Us</em>, <em>28</em>(6), 538–551. <a href="https://doi.org/10.1111/j.2153-3490.1976.tb00701.x">https://doi.org/10.1111/j.2153-3490.1976.tb00701.x</a></p>
</div>
<div id="ref-MacFarling_Meure2006-wa">
<p>MacFarling Meure, C., Etheridge, D., Trudinger, C., Steele, P., Langenfelds, R., Ommen, T. van, et al. (2006). Law dome CO2 , CH4 and N2O ice core records extended to 2000 years BP. <em>Geophys. Res. Lett.</em>, <em>33</em>(14), 101. <a href="https://doi.org/10.1029/2006GL026152">https://doi.org/10.1029/2006GL026152</a></p>
</div>
<div id="ref-Nicholls2008-af">
<p>Nicholls, R. J., Tol, R. S. J., &amp; Vafeidis, A. T. (2008). Global estimates of the impact of a collapse of the west antarctic ice sheet: An application of FUND. <em>Clim. Change</em>, <em>91</em>(1), 171. <a href="https://doi.org/10.1007/s10584-008-9424-y">https://doi.org/10.1007/s10584-008-9424-y</a></p>
</div>
<div id="ref-Spanger-Siegfried2014-mx">
<p>Spanger-Siegfried, E., Fitzpatrick, M., &amp; Dahl, K. (2014). <em>Encroaching tides - union of concerned scientists</em>. Cambridge, MA: Union of Concerned Scientists.</p>
</div>
</div>
</body></html>

<p style="text-align: center;">
<a href="julia-syntax.html"><button class="btn btn-default">Previous</button></a>
<a href="normal-distributions-and-the-galton-board.html"><button class="btn btn-default">Next</button></a>
</p>
<p class="build-date">Page built: 
2021-12-15
 using 
R version 4.1.2 (2021-11-01)
</p>
</div>
</div>



</body>
</html>
